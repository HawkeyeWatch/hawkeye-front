<p *ngIf="!nodes?.length">
  Appears that you have no nodes. You can <a (click)="openModal(nodeCreationModal)" href="javascript:void(0);">create</a> or
   <a (click)="openModal(nodeAdditionModal)" href="javascript:void(0);">add</a> some.
</p>
<div *ngIf="nodes?.length">
  <div class="row" style="margin-bottom: 20px;">
    <div class="col-4">
      <button class="btn btn-primary pull-left float-left" (click)="openModal(nodeAdditionModal)">Add existing node</button>
    </div>
    <div class="col-4" style="text-align: center">
      <button class="btn btn-default" (click)="getNodes()">Refresh</button>
    </div>
    <div class="col-4">
      <button class="btn btn-info pull-right float-right" (click)="openModal(nodeCreationModal)">Create node</button>
    </div>
  </div>
  <accordion>
    <accordion-group *ngFor="let node of nodes; index as $i">
      <div accordion-heading class="clearfix">
        {{node.title}}
        <span class="badge node-badge badge-secondary float-right pull-right">{{node.jstpLogin}}</span>
        <span class="badge node-badge badge-danger float-right pull-right" *ngIf="!node.isConnected">Offline</span>
        <span class="badge node-badge badge-success float-right pull-right" *ngIf="node.isConnected">Online</span>
      </div>
      <div class="row">
        <div class="col-12">
          ohyeah
        </div>
        <div class="col-12">
          <button class="btn btn-danger pull-right float-right" (click)="openModalDelete(nodeDeleteModal, $i)">Delete node</button>
        </div>
      </div>
    </accordion-group>
  </accordion>
</div>
<ng-template #nodeDeleteModal>
  <div class="modal-header">
    <h5 class="modal-title">Delete modal</h5>
    <button type="button" class="close" aria-label="Close" (click)="closeModal()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <p>Are you sure?</p>
    <div class="alert alert-danger" *ngIf="error">
      {{error}}
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="closeModal()">Close</button>
    <button type="button" class="btn btn-danger" (click)="deleteChosenNode()">Yes, delete this node</button>
  </div>
</ng-template>
<ng-template #nodeAdditionModal>
  <form #nodeCreationForm="ngForm">
    <div class="modal-header">
      <h5 class="modal-title">Add existing node</h5>
      <button type="button" class="close" aria-label="Close" (click)="closeModal()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label for="loginAdditionInput">Node login</label>
        <input
          type="text"
          class="form-control"
          id="loginAdditionInput"
          name="loginAdditionInput"
          required
          placeholder="Title"
          [(ngModel)]="newNode.jstpLogin"
          #loginAdditionInput="ngModel"
          [class]="'form-control ' + 
          (loginAdditionInput.invalid && (loginAdditionInput.dirty || loginAdditionInput.touched) ? 'is-invalid ' : '') + 
          (loginAdditionInput.valid && (loginAdditionInput.dirty || loginAdditionInput.touched) ? 'is-valid' : '')">
          <label for="titleInput">Node password</label>
          <input
            type="password"
            class="form-control"
            id="passwordAdditionInput"
            name="passwordAdditionInput"
            required
            placeholder="Title"
            [(ngModel)]="newNode.jstpPassword"
            #passwordAdditionInput="ngModel"
            [class]="'form-control ' + 
            (passwordAdditionInput.invalid && (passwordAdditionInput.dirty || passwordAdditionInput.touched) ? 'is-invalid ' : '') + 
            (passwordAdditionInput.valid && (passwordAdditionInput.dirty || passwordAdditionInput.touched) ? 'is-valid' : '')">
      </div>
      <div class="alert alert-danger" *ngIf="error">
        {{error}}
      </div>
    </div>
    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-primary"
        (click)="addNode()"
        [disabled]="nodeCreationForm.invalid"
        *ngIf="!creationDone">
        Create
      </button>
      <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
    </div>
  </form>
</ng-template>
<ng-template #nodeCreationModal>
  <form #nodeCreationForm="ngForm">
    <div class="modal-header">
      <h5 class="modal-title">Create node</h5>
      <button type="button" class="close" aria-label="Close" (click)="closeModal()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <div class="form-group" *ngIf="!creationDone">
        <label for="titleCreationInput">New node title</label>
        <input
          type="text"
          class="form-control"
          id="titleCreationInput"
          name="titleCreationInput"
          required
          placeholder="Title"
          [(ngModel)]="newNode.title"
          #titleCreationInput="ngModel"
          [class]="'form-control ' + 
          (titleCreationInput.invalid && (titleCreationInput.dirty || titleCreationInput.touched) ? 'is-invalid ' : '') + 
          (titleCreationInput.valid && (titleCreationInput.dirty || titleCreationInput.touched) ? 'is-valid' : '')">
      </div>
      <div class="row" *ngIf="creationDone">
        <div class="col-12">
          New node title: {{newNode.title}}
        </div>
        <div class="col-12">
          New node login: <code>{{newNode.jstpLogin}}</code>
        </div>
        <div class="col-12">
          New node password: <code>{{newNode.jstpPassword}}</code>
        </div>
        <div class="col-12">
          New node connection link: <code>{{newNode.link}}</code>
        </div>
        <div class="col-12">
          <div class="alert alert-warning">
              Make sure to write password and connection link somewhere in the safe place,
              because password is stored in encrypted way, and you will not be able to retreive or change it later.
          </div>
        </div>
      </div>
      <div class="alert alert-danger" *ngIf="error">
        {{error}}
      </div>
    </div>
    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-primary"
        (click)="createNode()"
        [disabled]="nodeCreationForm.invalid"
        *ngIf="!creationDone">
        Create
      </button>
      <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
    </div>
  </form>
</ng-template>